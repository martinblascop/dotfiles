plugins:
  helm-default-values:
    shortCut: Shift-V
    confirm: false
    description: Chart Default Values
    scopes:
      - helmreleases
    command: sh
    background: false
    args:
      - -c
      - >-
        revision=$(helm history -n $NAMESPACE --kube-context $CONTEXT $COL-NAME | grep deployed | awk '{ printf  $1 }');
        kubectl get secrets --context $CONTEXT -n $NAMESPACE sh.helm.release.v1.$COL-NAME.v$revision -o yaml
        | yq e '.data.release' -
        | base64 -d
        | base64 -d
        | gunzip
        | jq -r '.chart.values'
        | yq -P
        | vim - +'set filetype=yaml'
  certificate-request:
    shortCut: Shift-C
    confirm: false
    description: View CertificateRequest
    scopes:
      - certificaterequests
    command: sh
    background: false
    args:
      - -c
      - >-
        kubectl get certificaterequest/$COL-NAME --context $CONTEXT -n $NAMESPACE -o template='{{.status.certificate | base64decode}}'
        | openssl x509 -text
        | less -K
  get-aws-ec2-node:
    shortCut: Shift-V
    confirm: false
    description: EC2-TYPE-JSON
    scopes:
      - nodes
    command: sh
    background: false
    args:
      - -c
      - >-
        kubectl get nodes/$COL-NAME --context $CONTEXT -o template='{{ index .metadata.labels "node.kubernetes.io/instance-type" }}'
        | aws ec2 describe-instance-types --instance-types m6a.2xlarge --profile $CONTEXT
        | less -K
        | vim - +'set filetype=json'
  view-aws-ec2-node:
    shortCut: Shift-X
    confirm: false
    description: EC2-CPU-MEM
    scopes:
      - nodes
    command: sh
    background: false
    args:
      - -c
      - >-
        eks-node-viewer --context $CONTEXT --resources cpu,memory --node-sort name --disable-pricing
  refresh-external-secrets:
    shortCut: Shift-R
    confirm: false
    scopes:
      - externalsecrets
    description: Refresh ExternalSecret
    command: bash
    background: false
    args:
      - -c
      - "kubectl annotate externalsecrets.external-secrets.io --context $CONTEXT -n $NAMESPACE $NAME force-sync=$(date +%s) --overwrite"
